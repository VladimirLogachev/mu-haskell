<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Mu.Server</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Mu.Server.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">mu-rpc-0.2.0.0: Protocol-independent declaration of services and servers.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Mu.Server</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Servers and handlers</a><ul><li><a href="#g:2">Simple servers using only IO</a></li></ul></li><li><a href="#g:3">Errors which might be raised</a><ul><li><a href="#g:4">Useful when you do not want to deal with errors</a></li></ul></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>A server (represented by <code><a href="Mu-Server.html#t:ServerT" title="Mu.Server">ServerT</a></code>) is a sequence
of handlers (represented by <code><a href="Mu-Server.html#t:HandlersT" title="Mu.Server">HandlersT</a></code>), one for each
operation in the corresponding Mu service declaration.</p><p>In general, you should declare a server as:</p><pre>server :: MonadServer m =&gt; ServerT w MyService m _
server = Server (h1 :&lt;|&gt;: h2 :&lt;|&gt;: ... :&lt;|&gt;: H0)</pre><p>where each of <code>h1</code>, <code>h2</code>, ... handles each method in
<code>MyService</code> <em>in the order they were declared</em>.
The <code>_</code> in the type allows GHC to fill in the boring
and long type you would need to write there otherwise.</p><p><em>Implementation note</em>: exceptions raised in handlers
produce an error to be sent as response to the client.
We recommend you to catch exceptions and return custom
<code><a href="Mu-Server.html#t:ServerError" title="Mu.Server">ServerError</a></code>s instead.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">type</span> <a href="#t:MonadServer">MonadServer</a> m = (<a href="http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Error-Class.html#t:MonadError" title="Control.Monad.Error.Class">MonadError</a> <a href="Mu-Server.html#t:ServerError" title="Mu.Server">ServerError</a> m, <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m)</li><li class="src short"><span class="keyword">data</span> <a href="#t:ServerT">ServerT</a> (w :: <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a>) (s :: <a href="Mu-Rpc.html#t:Service" title="Mu.Rpc">Service</a> snm mnm) (m :: <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a>) (hs :: [<a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a>]) <span class="keyword">where</span><ul class="subs"><li><a href="#v:Server">Server</a> :: <a href="Mu-Server.html#t:HandlersT" title="Mu.Server">HandlersT</a> w methods m hs -&gt; <a href="Mu-Server.html#t:ServerT" title="Mu.Server">ServerT</a> w (<a href="Mu-Rpc.html#v:Service" title="Mu.Rpc">Service</a> sname anns methods) m hs</li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:HandlersT">HandlersT</a> (w :: <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a>) (methods :: [<a href="Mu-Rpc.html#t:Method" title="Mu.Rpc">Method</a> mnm]) (m :: <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a>) (hs :: [<a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a>]) <span class="keyword">where</span><ul class="subs"><li><a href="#v:H0">H0</a> :: <a href="Mu-Server.html#t:HandlersT" title="Mu.Server">HandlersT</a> w '[] m '[]</li><li><a href="#v::-60--124--62-:">(:&lt;|&gt;:)</a> :: Handles w args ret m h =&gt; h -&gt; <a href="Mu-Server.html#t:HandlersT" title="Mu.Server">HandlersT</a> w ms m hs -&gt; <a href="Mu-Server.html#t:HandlersT" title="Mu.Server">HandlersT</a> w (<a href="Mu-Rpc.html#v:Method" title="Mu.Rpc">Method</a> name anns args ret ': ms) m (h ': hs)</li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:ServerErrorIO">ServerErrorIO</a> = <a href="http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Except.html#t:ExceptT" title="Control.Monad.Except">ExceptT</a> <a href="Mu-Server.html#t:ServerError" title="Mu.Server">ServerError</a> <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/System-IO.html#t:IO" title="System.IO">IO</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:ServerIO">ServerIO</a> w srv = <a href="Mu-Server.html#t:ServerT" title="Mu.Server">ServerT</a> w srv <a href="Mu-Server.html#t:ServerErrorIO" title="Mu.Server">ServerErrorIO</a></li><li class="src short"><a href="#v:serverError">serverError</a> :: <a href="http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Error-Class.html#t:MonadError" title="Control.Monad.Error.Class">MonadError</a> <a href="Mu-Server.html#t:ServerError" title="Mu.Server">ServerError</a> m =&gt; <a href="Mu-Server.html#t:ServerError" title="Mu.Server">ServerError</a> -&gt; m a</li><li class="src short"><span class="keyword">data</span> <a href="#t:ServerError">ServerError</a> = <a href="#v:ServerError">ServerError</a> <a href="Mu-Server.html#t:ServerErrorCode" title="Mu.Server">ServerErrorCode</a> <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-String.html#t:String" title="Data.String">String</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:ServerErrorCode">ServerErrorCode</a><ul class="subs"><li>= <a href="#v:Unknown">Unknown</a></li><li>| <a href="#v:Unavailable">Unavailable</a></li><li>| <a href="#v:Unimplemented">Unimplemented</a></li><li>| <a href="#v:Unauthenticated">Unauthenticated</a></li><li>| <a href="#v:Internal">Internal</a></li><li>| <a href="#v:Invalid">Invalid</a></li><li>| <a href="#v:NotFound">NotFound</a></li></ul></li><li class="src short"><a href="#v:alwaysOk">alwaysOk</a> :: <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; m a</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Servers and handlers</h1></a><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:MonadServer" class="def">MonadServer</a> m = (<a href="http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Error-Class.html#t:MonadError" title="Control.Monad.Error.Class">MonadError</a> <a href="Mu-Server.html#t:ServerError" title="Mu.Server">ServerError</a> m, <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m) <a href="src/Mu.Server.html#MonadServer" class="link">Source</a> <a href="#t:MonadServer" class="selflink">#</a></p><div class="doc"><p>Constraint for monads that can be used as servers</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ServerT" class="def">ServerT</a> (w :: <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a>) (s :: <a href="Mu-Rpc.html#t:Service" title="Mu.Rpc">Service</a> snm mnm) (m :: <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a>) (hs :: [<a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a>]) <span class="keyword">where</span> <a href="src/Mu.Server.html#ServerT" class="link">Source</a> <a href="#t:ServerT" class="selflink">#</a></p><div class="doc"><p>Definition of a complete server for a service.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Server" class="def">Server</a> :: <a href="Mu-Server.html#t:HandlersT" title="Mu.Server">HandlersT</a> w methods m hs -&gt; <a href="Mu-Server.html#t:ServerT" title="Mu.Server">ServerT</a> w (<a href="Mu-Rpc.html#v:Service" title="Mu.Rpc">Service</a> sname anns methods) m hs</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:HandlersT" class="def">HandlersT</a> (w :: <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a>) (methods :: [<a href="Mu-Rpc.html#t:Method" title="Mu.Rpc">Method</a> mnm]) (m :: <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a>) (hs :: [<a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type" title="Data.Kind">Type</a>]) <span class="keyword">where</span> <a href="src/Mu.Server.html#HandlersT" class="link">Source</a> <a href="#t:HandlersT" class="selflink">#</a></p><div class="doc"><p><code><a href="Mu-Server.html#t:HandlersT" title="Mu.Server">HandlersT</a></code> is a sequence of handlers.
   Note that the handlers for your service
   must appear <strong>in the same order</strong> as they
   are defined.</p><p>In general you can choose any type you want
   for your handlers, due to the following restrictions:</p><ul><li>Haskell types must be convertible to the
     corresponding schema type. In other words,
     they must implement <code>FromSchema</code> if they are
     inputs, and <code>ToSchema</code> if they are outputs.</li><li>Normal returns are represented by returning
     the corresponding Haskell type.</li><li>Input streams turn into <code>Conduit () t m ()</code>,
     where <code>t</code> is the Haskell type for that schema type.</li><li>Output streams turn into an <strong>additional argument</strong>
     of type <code>Conduit t Void m ()</code>. This stream should
     be connected to a source to get the elements.</li></ul></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:H0" class="def">H0</a> :: <a href="Mu-Server.html#t:HandlersT" title="Mu.Server">HandlersT</a> w '[] m '[]</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v::-60--124--62-:" class="def">(:&lt;|&gt;:)</a> :: Handles w args ret m h =&gt; h -&gt; <a href="Mu-Server.html#t:HandlersT" title="Mu.Server">HandlersT</a> w ms m hs -&gt; <a href="Mu-Server.html#t:HandlersT" title="Mu.Server">HandlersT</a> w (<a href="Mu-Rpc.html#v:Method" title="Mu.Rpc">Method</a> name anns args ret ': ms) m (h ': hs) <span class="fixity">infixr 5</span><span class="rightedge"></span></td><td class="doc empty">&nbsp;</td></tr></table></div></div><a href="#g:2" id="g:2"><h2>Simple servers using only IO</h2></a><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:ServerErrorIO" class="def">ServerErrorIO</a> = <a href="http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Except.html#t:ExceptT" title="Control.Monad.Except">ExceptT</a> <a href="Mu-Server.html#t:ServerError" title="Mu.Server">ServerError</a> <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/System-IO.html#t:IO" title="System.IO">IO</a> <a href="src/Mu.Server.html#ServerErrorIO" class="link">Source</a> <a href="#t:ServerErrorIO" class="selflink">#</a></p><div class="doc"><p>Simplest monad which satisfies <code><a href="Mu-Server.html#t:MonadServer" title="Mu.Server">MonadServer</a></code>.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:ServerIO" class="def">ServerIO</a> w srv = <a href="Mu-Server.html#t:ServerT" title="Mu.Server">ServerT</a> w srv <a href="Mu-Server.html#t:ServerErrorIO" title="Mu.Server">ServerErrorIO</a> <a href="src/Mu.Server.html#ServerIO" class="link">Source</a> <a href="#t:ServerIO" class="selflink">#</a></p><div class="doc"><p>Simple <code><a href="Mu-Server.html#t:ServerT" title="Mu.Server">ServerT</a></code> which uses only <code><a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/System-IO.html#t:IO" title="System.IO">IO</a></code> and errors.</p></div></div><a href="#g:3" id="g:3"><h1>Errors which might be raised</h1></a><div class="top"><p class="src"><a id="v:serverError" class="def">serverError</a> :: <a href="http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Error-Class.html#t:MonadError" title="Control.Monad.Error.Class">MonadError</a> <a href="Mu-Server.html#t:ServerError" title="Mu.Server">ServerError</a> m =&gt; <a href="Mu-Server.html#t:ServerError" title="Mu.Server">ServerError</a> -&gt; m a <a href="src/Mu.Server.html#serverError" class="link">Source</a> <a href="#v:serverError" class="selflink">#</a></p><div class="doc"><p>Stop the current handler,
   returning an error to the client.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ServerError" class="def">ServerError</a> <a href="src/Mu.Server.html#ServerError" class="link">Source</a> <a href="#t:ServerError" class="selflink">#</a></p><div class="doc"><p>Errors raised in a handler.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ServerError" class="def">ServerError</a> <a href="Mu-Server.html#t:ServerErrorCode" title="Mu.Server">ServerErrorCode</a> <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ServerErrorCode" class="def">ServerErrorCode</a> <a href="src/Mu.Server.html#ServerErrorCode" class="link">Source</a> <a href="#t:ServerErrorCode" class="selflink">#</a></p><div class="doc"><p>Possible types of errors.
   Some of these are handled in a special way
   by different transpoprt layers.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Unknown" class="def">Unknown</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:Unavailable" class="def">Unavailable</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:Unimplemented" class="def">Unimplemented</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:Unauthenticated" class="def">Unauthenticated</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:Internal" class="def">Internal</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:Invalid" class="def">Invalid</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:NotFound" class="def">NotFound</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><details id="i:ServerErrorCode" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ServerErrorCode:Eq:1"></span> <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Mu-Server.html#t:ServerErrorCode" title="Mu.Server">ServerErrorCode</a></span> <a href="src/Mu.Server.html#line-88" class="link">Source</a> <a href="#t:ServerErrorCode" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ServerErrorCode:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Mu-Server.html">Mu.Server</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Mu-Server.html#t:ServerErrorCode" title="Mu.Server">ServerErrorCode</a> -&gt; <a href="Mu-Server.html#t:ServerErrorCode" title="Mu.Server">ServerErrorCode</a> -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Mu-Server.html#t:ServerErrorCode" title="Mu.Server">ServerErrorCode</a> -&gt; <a href="Mu-Server.html#t:ServerErrorCode" title="Mu.Server">ServerErrorCode</a> -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ServerErrorCode:Show:2"></span> <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Mu-Server.html#t:ServerErrorCode" title="Mu.Server">ServerErrorCode</a></span> <a href="src/Mu.Server.html#line-88" class="link">Source</a> <a href="#t:ServerErrorCode" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ServerErrorCode:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Mu-Server.html">Mu.Server</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Mu-Server.html#t:ServerErrorCode" title="Mu.Server">ServerErrorCode</a> -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Mu-Server.html#t:ServerErrorCode" title="Mu.Server">ServerErrorCode</a> -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Mu-Server.html#t:ServerErrorCode" title="Mu.Server">ServerErrorCode</a>] -&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><a href="#g:4" id="g:4"><h2>Useful when you do not want to deal with errors</h2></a><div class="top"><p class="src"><a id="v:alwaysOk" class="def">alwaysOk</a> :: <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; m a <a href="src/Mu.Server.html#alwaysOk" class="link">Source</a> <a href="#v:alwaysOk" class="selflink">#</a></p><div class="doc"><p>Wrapper for handlers which do not use errors.
   Remember that any exception raised in <code><a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/System-IO.html#t:IO" title="System.IO">IO</a></code>
   is propagated to the client.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>